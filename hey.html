<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday! </title>
    <!-- Use Tailwind CSS for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load the Tone.js library for audio synthesis -->
    <script src="https://unpkg.com/tone@14.7.58/build/Tone.js"></script>
    <!-- Load Phosphor Icons for game UI -->
    <script src="https://unpkg.com/@phosphor-icons/web@2.1.1"></script>
    <!-- Load Three.js library for 3D graphics -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            color: #e0e0e0; /* Light color for text */
            background-color: #0b0c1e; /* Dark background for night sky effect */
            overflow-x: hidden;
            position: relative;
        }

        /* Sparkle effect for the background */
        .sparkle-star {
            position: absolute;
            background-color: #ffffff;
            opacity: 0;
            border-radius: 50%;
            animation: twinkle 5s infinite ease-in-out;
            pointer-events: none;
        }

        @keyframes twinkle {
            0%, 100% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
        }

        /* Custom scrollbar styling for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1b32;
        }
        ::-webkit-scrollbar-thumb {
            background: #f67280;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #c06c84;
        }

        /* Custom CSS for the 3D photo effect on hover */
        .photo-card {
            transform-style: preserve-3d;
            transition: transform 0.5s ease-in-out;
            transform: rotateX(0) rotateY(0);
        }
        .photo-card:hover {
            transform: rotateX(5deg) rotateY(5deg) translateZ(20px);
        }
        .photo-img {
            transition: transform 0.5s ease-in-out;
        }
        .photo-card:hover .photo-img {
            transform: scale(1.05);
        }

        /* Custom CSS for the typing animation effect */
        .typing-container {
            display: inline-block;
            white-space: pre-wrap;
            overflow: hidden;
            border-right: 2px solid;
            animation: blink-caret .75s step-end infinite;
        }
        
        /* The typewriter cursor animation */
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: #f67280; }
        }

        /* Game specific styles */
        #gameCanvas {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
            touch-action: none; /* Disable default touch actions */
        }

        .game-controls {
            display: none; /* Hide on larger screens */
        }
        @media (max-width: 640px) {
            .game-controls {
                display: flex;
            }
        }
        
        /* Confetti animation */
        .confetti {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #f67280;
            opacity: 0;
            animation: confetti-fall 2s forwards;
        }
        @keyframes confetti-fall {
            from { transform: translateY(0) rotate(0); opacity: 1; }
            to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* Modal for game win */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #2a2a44;
            color: #fff;
            padding: 2.5rem;
            border-radius: 1rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 90%;
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        #rotating-cake-container {
            position: relative;
            width: 100%;
            height: 400px;
        }

    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-purple-100 to-indigo-100 min-h-screen p-4 sm:p-8">

    <!-- Starry Night Background Effect -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const body = document.body;
            for (let i = 0; i < 50; i++) {
                const sparkle = document.createElement('div');
                sparkle.classList.add('sparkle-star');
                sparkle.style.width = `${Math.random() * 3 + 1}px`;
                sparkle.style.height = sparkle.style.width;
                sparkle.style.left = `${Math.random() * 100}%`;
                sparkle.style.top = `${Math.random() * 100}%`;
                sparkle.style.animationDelay = `${Math.random() * 5}s`;
                body.appendChild(sparkle);
            }
        });
    </script>
    
    <!-- Main Container -->
    <div class="max-w-6xl mx-auto space-y-8 relative z-10">
        <!-- Main Heading -->
        <header class="text-center py-8">
            <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold text-pink-400 drop-shadow-md animate-pulse">
                Happy Birthday NANDINI!
            </h1>
            <p class="mt-2 text-lg text-purple-300">A little surprise just for youâœ¨.</p>
        </header>

        <!-- 1. Wishing Bar -->
        <div class="bg-gray-800 rounded-xl shadow-lg p-6 sm:p-8 transform transition-transform duration-300 hover:scale-[1.01] border border-fuchsia-500">
            <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-purple-300">For The Honoured OneðŸ¦œ</h2>
            <div id="typingMessage" class="typing-container text-lg sm:text-xl leading-relaxed text-gray-300"></div>
        </div>

        <!-- 2. Photos Bar -->
        <div class="bg-gray-800 rounded-xl shadow-lg p-6 sm:p-8 transform transition-transform duration-300 hover:scale-[1.01] border border-fuchsia-500">
            <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-purple-300">BIRTHDAY KI SHUBHKAMNAAY</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Photo Card 1 -->
                <div class="photo-card bg-gray-900 rounded-lg p-4 shadow-md transition-shadow hover:shadow-xl">
                    <img src="https://media.tenor.com/gDHmnYfImaUAAAAM/happy-happy-happy-happy.gif" alt="Friend 1" class="photo-img w-full h-auto rounded-lg shadow-sm">
                    <p class="mt-3 text-center text-sm text-gray-400">ITS</p>
                </div>
                <!-- Photo Card 2 -->
                <div class="photo-card bg-gray-900 rounded-lg p-4 shadow-md transition-shadow hover:shadow-xl">
                    <img src="https://media.tenor.com/OEjqB_zl7iIAAAAM/voldemort-laughing.gif" alt="Friend 2" class="photo-img w-full h-auto rounded-lg shadow-sm">
                    <p class="mt-3 text-center text-sm text-gray-400">YOUR</p>
                </div>
                <!-- Photo Card 3 -->
                <div class="photo-card bg-gray-900 rounded-lg p-4 shadow-md transition-shadow hover:shadow-xl">
                    <img src="https://esbirthday.com/img/g/nandini/happy-birthday-gif-funny-nandini.gif" alt="Friend 3" class="photo-img w-full h-auto rounded-lg shadow-sm">
                    <p class="mt-3 text-center text-sm text-gray-400">BIRTHDAY</p>
                </div>
            </div>
        </div>

        <!-- 3. Song Bar -->
        <div class="bg-gray-800 rounded-xl shadow-lg p-6 sm:p-8 transform transition-transform duration-300 hover:scale-[1.01] flex flex-col items-center border border-fuchsia-500">
            <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-purple-300">A Little Song For You</h2>
            <button id="playSongButton" class="group bg-fuchsia-500 hover:bg-fuchsia-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 ease-in-out transform hover:scale-105">
                <div class="flex items-center space-x-2">
                    <i class="ph ph-play group-[.playing]:hidden"></i>
                    <i class="ph ph-stop hidden group-[.playing]:block"></i>
                    <span  class="group-[.playing]:hidden">Play Happy Birthday</span>
                    <span class="hidden group-[.playing]:block">Stop Song</span>
                    <!-- Add this somewhere inside your HTML (probably near the song bar) -->
<audio id="birthdaySong" src="onee.mp3"></audio>

                    
                </div>
            </button>
            <p id="songStatus" class="mt-4 text-sm text-gray-500 italic">Music: Happy Birthday melody synthesized with Tone.js.</p>
        </div>

        <!-- 4. 3D Model -->
        <div class="bg-gray-800 rounded-xl shadow-lg p-6 sm:p-8 transform transition-transform duration-300 hover:scale-[1.01] flex flex-col items-center border border-fuchsia-500">
            <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-purple-300">A Rotating Surprise</h2>
            <!-- Cake Tab -->
<div id="cake" class="tab-content flex justify-center items-center">
    <canvas id="cakeCanvas" class="w-full max-w-2xl h-96 rounded-xl shadow-lg"></canvas>
</div>


            <p class="mt-4 text-sm text-gray-500 italic">An animated 3D birthday cake made with Three.js</p>
        </div>

        <!-- 5. More Surprise (Game) -->
        <div class="bg-gray-800 rounded-xl shadow-lg p-6 sm:p-8 transform transition-transform duration-300 hover:scale-[1.01] border border-fuchsia-500">
            <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-purple-300">A Little Game...</h2>
            <p class="text-center text-gray-400 mb-4">Catch the falling cakes! Score 10 to unlock a special gift.</p>
            <div class="flex flex-col items-center justify-center space-y-4">
                <canvas id="gameCanvas" class="w-full max-w-sm hidden"></canvas>
                <div id="gameStartContainer" class="flex flex-col items-center">
                    <button id="startGameButton" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 ease-in-out transform hover:scale-105 animate-pulse">
                        <div class="flex items-center space-x-2">
                            <i class="ph ph-game-controller-bold text-xl"></i>
                            <span>Play Game</span>
                        </div>
                    </button>
                </div>
                <div id="gameInfo" class="hidden flex items-center justify-between w-full max-w-sm px-2">
                    <p class="text-lg font-bold text-gray-300">Score: <span id="scoreDisplay">0</span></p>
                    <p class="text-lg font-bold text-gray-300">High Score: <span id="highScoreDisplay">0</span></p>
                </div>
                <div class="game-controls hidden space-x-4 mt-4 w-full justify-center max-w-sm">
                    <button id="leftButton" class="bg-indigo-500 text-white p-4 rounded-full shadow-lg transition-transform active:scale-90">
                        <i class="ph ph-caret-left-bold text-xl"></i>
                    </button>
                    <button id="rightButton" class="bg-indigo-500 text-white p-4 rounded-full shadow-lg transition-transform active:scale-90">
                        <i class="ph ph-caret-right-bold text-xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Win Modal -->
        <div id="winModal" class="modal">
            <div class="modal-content">
                <h3 class="text-3xl font-bold text-green-400 mb-4">You Won!</h3>
                <p class="text-lg text-gray-300 mb-6">You've caught all the cakes! As a reward, here are a few novels to bring you peace and happiness. Enjoy!</p>
                <div class="flex flex-col space-y-4">
                    <a href="https://www.gutenberg.org/ebooks/1614.html.images" target="_blank" class="reward-link inline-block bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-transform hover:scale-105">
                        "The Art of Living" by Epictetus
                    </a>
                    <a href="https://www.gutenberg.org/ebooks/71590" target="_blank" class="reward-link inline-block bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-transform hover:scale-105">
                        "The Secret Garden" by Frances Hodgson Burnett
                    </a>
                    <a href="https://www.gutenberg.org/ebooks/6226" target="_blank" class="reward-link inline-block bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-transform hover:scale-105">
                        "The Wonderful Wizard of Oz" by L. Frank Baum
                    </a>
                </div>
                <button id="playAgainButton" class="mt-6 bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 ease-in-out transform hover:scale-105">
                    Play Again
                </button>
            </div>
        </div>

    </div>

    <script>
        window.onload = function() {
            // --- 1. Typing Animation for the Wishing Bar ---
            const message = "My Dearest Friend,\n\nHappy, happy birthday! I wanted to create something special for you to celebrate this day. I hope this little website brings a smile to your face and reminds you of how Special You are. Thank you for being such an incredible friend and for all the amazing moments we've shared. I wish you nothing but joy, success, and endless happiness in the year ahead. May this new chapter be filled with wonderful adventures and beautiful memories. You deserve all the best things in the world. Have a fantastic day! On this day, the world took a pause,To celebrate you, just because,A friend so dear, so kind, so true,The stars aligned to bring us you.With laughter bright and heart so warm,You bring a light, youâ€™re like a charm,In every smile and every cheer,You make the moments more sincere.May your day be filled with joy,Like a child with a brand-new toy,With every wish and dream in sight,May your path be clear and bright.Hereâ€™s to the times weâ€™ve yet to share,To every memory beyond compare,To adventures grand and simple too,Today and always, cheers to you!Thus, lift your glass and toast.To the friend we love the most,Happy birthday, hereâ€™s to more,To laughter, love, and so much more.";
            const typingElement = document.getElementById('typingMessage');
            let i = 0;
            const typingSpeed = 50; // milliseconds

            function typeWriter() {
                if (i < message.length) {
                    // Check for a newline character and add it as a line break
                    if (message.charAt(i) === '\n') {
                        typingElement.innerHTML += '<br>';
                    } else {
                        typingElement.textContent += message.charAt(i);
                    }
                    i++;
                    setTimeout(typeWriter, typingSpeed);
                } else {
                    // Stop the blinking cursor after the message is complete
                    typingElement.style.borderRight = 'none';
                }
            }
            typeWriter();

            // --- 2. 3D Photos (Handled by CSS) ---

            // --- 3. Song Player (Tone.js) ---
           // --- 3. Song Player (Using Audio File Instead of Tone.js) ---
const playSongButton = document.getElementById('playSongButton');
const song = document.getElementById('birthdaySong');
let isPlaying = false;

function toggleSong() {
    if (isPlaying) {
        song.pause();
        
        isPlaying = false;
        playSongButton.classList.remove('playing');
    } else {
        song.play();
        isPlaying = true;
        playSongButton.classList.add('playing');
         song.onended = () => {
            isPlaying = false;
            playSongButton.classList.remove('playing');
        };
    }
}

playSongButton.addEventListener('click', toggleSong);


            // --- 4. 3D Birthday Cake (Three.js) ---
           // --- 4. 3D Cake (Improved Design) ---
// --- 4. 3D Cake (Improved Design with Text) ---
// --- 4. 3D Cake (Improved Design with Animated Text) ---
// --- 4. 3D Cake (Animated Floating Text) ---
// --- 4. 3D Cake (Animated Floating Text + Sparkles) ---
const cakeCanvas = document.getElementById('cakeCanvas');
const cakeScene = new THREE.Scene();
const cakeCamera = new THREE.PerspectiveCamera(
    75,
    cakeCanvas.clientWidth / cakeCanvas.clientHeight,
    0.1,
    1000
);
const cakeRenderer = new THREE.WebGLRenderer({ canvas: cakeCanvas, alpha: true });
cakeRenderer.setSize(cakeCanvas.clientWidth, cakeCanvas.clientHeight);

// Lighting
const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
const pointLight = new THREE.PointLight(0xffffff, 1.2);
pointLight.position.set(5, 5, 5);
cakeScene.add(ambientLight, pointLight);

// --- Cake Base (two layers) ---
const bottomCakeGeometry = new THREE.CylinderGeometry(2, 2, 1.2, 64);
const bottomCakeMaterial = new THREE.MeshStandardMaterial({ color: 0xffcba4 });
const bottomCake = new THREE.Mesh(bottomCakeGeometry, bottomCakeMaterial);
cakeScene.add(bottomCake);

const topCakeGeometry = new THREE.CylinderGeometry(1.6, 1.6, 1, 64);
const topCakeMaterial = new THREE.MeshStandardMaterial({ color: 0xffe5b4 });
const topCake = new THREE.Mesh(topCakeGeometry, topCakeMaterial);
topCake.position.y = 1.1;
cakeScene.add(topCake);

// --- Frosting Layer ---
const frostingGeometry = new THREE.CylinderGeometry(1.65, 1.65, 0.3, 64);
const frostingMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff });
const frosting = new THREE.Mesh(frostingGeometry, frostingMaterial);
frosting.position.y = 1.6;
cakeScene.add(frosting);

// --- Candles ---
const candleGeometry = new THREE.CylinderGeometry(0.08, 0.08, 0.6, 32);
const candleMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff });
const flameGeometry = new THREE.SphereGeometry(0.12, 16, 16);
const flameMaterial = new THREE.MeshStandardMaterial({
    color: 0xffd700,
    emissive: 0xffa500,
    emissiveIntensity: 1
});

const numCandles = 6;
const radius = 1.1;
const flames = [];

for (let i = 0; i < numCandles; i++) {
    const angle = (i / numCandles) * Math.PI * 2;
    const x = Math.cos(angle) * radius;
    const z = Math.sin(angle) * radius;

    const candle = new THREE.Mesh(candleGeometry, candleMaterial);
    candle.position.set(x, 2, z);

    const flame = new THREE.Mesh(flameGeometry, flameMaterial);
    flame.position.set(x, 2.4, z);

    cakeScene.add(candle, flame);
    flames.push(flame);
}

// --- 3D Text ("Happy Birthday!") ---
let birthdayText, textMaterial;
const loader = new THREE.FontLoader();
loader.load('https://threejs.org/examples/fonts/helvetiker_regular.typeface.json', function (font) {
    const textGeometry = new THREE.TextGeometry('Happy Birthday! NANDINI', {
        font: font,
        size: 0.5,
        height: 0.2,
        curveSegments: 12,
        bevelEnabled: true,
        bevelThickness: 0.03,
        bevelSize: 0.02,
        bevelSegments: 5
    });

    textGeometry.center();
    textMaterial = new THREE.MeshStandardMaterial({
        color: 0xff69b4, 
        emissive: 0xff1493,
        emissiveIntensity: 0.6
    });

    birthdayText = new THREE.Mesh(textGeometry, textMaterial);
    birthdayText.position.y = 3.2;
    cakeScene.add(birthdayText);
});

// --- Floating Sparkles Around Text ---
const sparkles = [];
const sparkleGeometry = new THREE.SphereGeometry(0.05, 8, 8);
const sparkleMaterial = new THREE.MeshStandardMaterial({ color: 0xffff66, emissive: 0xffffaa });

for (let i = 0; i < 20; i++) {
    const sparkle = new THREE.Mesh(sparkleGeometry, sparkleMaterial.clone());
    sparkle.orbitRadius = 0.8 + Math.random() * 0.6; // distance from text
    sparkle.orbitSpeed = 0.01 + Math.random() * 0.02;
    sparkle.angle = Math.random() * Math.PI * 2;
    sparkle.heightOffset = (Math.random() - 0.5) * 0.5;
    sparkle.position.set(
        Math.cos(sparkle.angle) * sparkle.orbitRadius,
        3.2 + sparkle.heightOffset,
        Math.sin(sparkle.angle) * sparkle.orbitRadius
    );
    cakeScene.add(sparkle);
    sparkles.push(sparkle);
}

// Camera
cakeCamera.position.z = 6;
cakeCamera.position.y = 2;

// Animation variables
let hue = 0;
let bobPhase = 0;

// Animation Loop
function animateCake() {
    requestAnimationFrame(animateCake);

    // Rotate cake layers
    bottomCake.rotation.y += 0.003;
    topCake.rotation.y += 0.003;
    frosting.rotation.y += 0.003;

    // Flicker flames
    flames.forEach(flame => {
        flame.scale.setScalar(0.9 + Math.random() * 0.3);
    });

    // Animate text
    if (birthdayText && textMaterial) {
        // Rotate
        birthdayText.rotation.y += 0.01;

        // Rainbow color
        hue += 0.5;
        if (hue > 360) hue = 0;
        const color = new THREE.Color(`hsl(${hue}, 100%, 50%)`);
        textMaterial.color = color;
        textMaterial.emissive = color;

        // Bob up and down
        bobPhase += 0.02;
        birthdayText.position.y = 3.2 + Math.sin(bobPhase) * 0.2;
    }

    // Animate sparkles
    sparkles.forEach(s => {
        s.angle += s.orbitSpeed;
        s.position.x = Math.cos(s.angle) * s.orbitRadius;
        s.position.z = Math.sin(s.angle) * s.orbitRadius;
        s.position.y = 3.2 + s.heightOffset + Math.sin(bobPhase + s.angle) * 0.1;
    });

    cakeRenderer.render(cakeScene, cakeCamera);
}
animateCake();



            // Handle window resizing for 3D canvas
            window.addEventListener('resize', () => {
                camera.aspect = cakeContainer.clientWidth / cakeContainer.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(cakeContainer.clientWidth, cakeContainer.clientHeight);
            });

            // --- 5. Birthday Game ---
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreDisplay = document.getElementById('scoreDisplay');
            const highScoreDisplay = document.getElementById('highScoreDisplay');
            const winModal = document.getElementById('winModal');
            const startGameButton = document.getElementById('startGameButton');
            const playAgainButton = document.getElementById('playAgainButton');
            const gameStartContainer = document.getElementById('gameStartContainer');
            const gameInfo = document.getElementById('gameInfo');
            const leftButton = document.getElementById('leftButton');
            const rightButton = document.getElementById('rightButton');

            // Game variables
            let player;
            let cakes = [];
            let score = 0;
            let highScore = localStorage.getItem('birthdayGameHighScore') || 0;
            let gameRunning = false;
            let cakeFallSpeed = 2;

            // Set canvas size and game element dimensions responsively
            function setCanvasSize() {
                const parentWidth = canvas.parentElement.clientWidth;
                const newWidth = Math.min(parentWidth, 300);
                const newHeight = newWidth * 1.5;
                
                // Set the canvas element's drawing buffer size
                canvas.width = newWidth;
                canvas.height = newHeight;
                
                // Update player dimensions and position based on new canvas size
                player = {
                    x: canvas.width / 2,
                    y: canvas.height - canvas.height * 0.1, // 10% from bottom
                    width: canvas.width * 0.15, // 15% of canvas width
                    height: canvas.width * 0.08, // 8% of canvas width
                    speed: canvas.width * 0.03
                };

                // Clear and redraw the canvas to adjust to new dimensions
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                if (gameRunning) {
                    gameLoop();
                } else {
                    drawPlayer();
                }
            }
            
            // Initial setup and event listeners for resizing
            setCanvasSize();
            window.addEventListener('resize', setCanvasSize);
            
            // Update high score display
            highScoreDisplay.textContent = highScore;

            // Function to reset the game
            function resetGame() {
                score = 0;
                cakes = [];
                scoreDisplay.textContent = score;
                player.x = canvas.width / 2;
                player.y = canvas.height - canvas.height * 0.1;
                cakeFallSpeed = 2; // Reset speed
            }
            
            // Function to create and animate confetti
            function createConfetti() {
                const colors = ['#f67280', '#c06c84', '#6c5b7b', '#355c7d', '#f67280'];
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.classList.add('confetti');
                    confetti.style.left = `${Math.random() * window.innerWidth}px`;
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                    confetti.style.animationDuration = `${Math.random() * 1.5 + 1}s`;
                    document.body.appendChild(confetti);
                }
            }

            // Function to draw player
            function drawPlayer() {
                // Draw a simple basket shape
                ctx.fillStyle = '#c06c84';
                ctx.beginPath();
                ctx.arc(player.x, player.y, player.width / 2, Math.PI, 0, false);
                ctx.lineTo(player.x + player.width / 2, player.y + player.height / 2);
                ctx.lineTo(player.x - player.width / 2, player.y + player.height / 2);
                ctx.closePath();
                ctx.fill();
            }

            // Function to draw cake
            function drawCake(cake) {
                // Cake bottom layer
                ctx.fillStyle = '#ffc0cb';
                ctx.beginPath();
                ctx.rect(cake.x - (cake.width / 2), cake.y, cake.width, cake.height / 2);
                ctx.fill();

                // Cake top layer (frosting)
                ctx.fillStyle = '#8e44ad';
                ctx.beginPath();
                ctx.ellipse(cake.x, cake.y, cake.width / 2, cake.height / 4, 0, 0, Math.PI * 2);
                ctx.fill();
            }

            // Game loop
            function gameLoop() {
                if (!gameRunning) return;

                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Spawn new cakes
                if (Math.random() < 0.02) {
                    cakes.push({
                        x: Math.random() * (canvas.width - 20) + 10,
                        y: -20,
                        width: canvas.width * 0.08, // 8% of canvas width
                        height: canvas.height * 0.05, // 5% of canvas height
                        speed: cakeFallSpeed
                    });
                }

                // Update and draw cakes
                cakes = cakes.filter(cake => {
                    cake.y += cake.speed;
                    drawCake(cake);

                    // Collision detection: Check if the cake is inside the player's catcher
                    if (
                        cake.x > player.x - player.width / 2 &&
                        cake.x < player.x + player.width / 2 &&
                        cake.y > player.y - player.height / 2 &&
                        cake.y < player.y + player.height / 2
                    ) {
                        score++;
                        scoreDisplay.textContent = score;
                        cakeFallSpeed += 0.1; // Increase speed slightly with each catch

                        if (score >= 10) {
                            gameRunning = false;
                            showWinModal();
                            createConfetti();
                            if (score > highScore) {
                                highScore = score;
                                localStorage.setItem('birthdayGameHighScore', highScore);
                                highScoreDisplay.textContent = highScore;
                            }
                        }
                        return false; // Remove the caught cake
                    }

                    return cake.y < canvas.height; // Keep cakes that are on screen
                });

                // Draw player
                drawPlayer();

                requestAnimationFrame(gameLoop);
            }

            // Keyboard controls
            document.addEventListener('keydown', (e) => {
                if (!gameRunning) return;
                if (e.key === 'ArrowLeft' && player.x > player.width / 2) {
                    player.x -= player.speed;
                } else if (e.key === 'ArrowRight' && player.x < canvas.width - player.width / 2) {
                    player.x += player.speed;
                }
            });

            // Mobile/touch controls
            leftButton.addEventListener('touchstart', (e) => {
                e.preventDefault(); // Prevent default touch behavior like scrolling
                if (!gameRunning) return;
                player.x -= player.speed * 2;
            });
            rightButton.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!gameRunning) return;
                player.x += player.speed * 2;
            });
            leftButton.addEventListener('mousedown', () => {
                if (!gameRunning) return;
                player.x -= player.speed * 2;
            });
            rightButton.addEventListener('mousedown', () => {
                if (!gameRunning) return;
                player.x += player.speed * 2;
            });
            
            // Function to start the game
            startGameButton.addEventListener('click', () => {
                gameRunning = true;
                resetGame();
                gameStartContainer.classList.add('hidden');
                canvas.classList.remove('hidden');
                gameInfo.classList.remove('hidden');
                const gameControls = document.querySelector('.game-controls');
                if (window.innerWidth <= 640) {
                    gameControls.classList.remove('hidden');
                }
                gameLoop();
            });

            // "Play Again" button listener
            playAgainButton.addEventListener('click', () => {
                winModal.style.display = 'none';
                gameRunning = true;
                resetGame();
                gameLoop();
            });

            // Function to show the modal
            function showWinModal() {
                winModal.style.display = 'flex';
                // Stop the song if it's playing
                if (isPlaying) {
                    toggleSong();
                }
            }
        };
    </script>
</body>
</html>
